
#!/bin/bash

# Affiche la liste des repo archivés à disposition dans ${REPOS_DIR}/

# On trie le contenu des fichiers de liste
sortLists

i=0;var_list_repo=""; # Initialisation de variable utilisées pour l'alternance des couleurs dans le tableau

if [ "$OS_FAMILY" == "Redhat" ];then
	TAILLE_COLONNES="%-40s %-15s %-10s %s\n"  # défini la taille de chaque colonnes qui seront affichées par printf ci-après, ex : %-40s : affichage d'une chaine (s) de 40 positions alignée à gauche (-). Pour la colonne Description (la dernière), on ne défini pas de taille car il peut s'agir d'une chaine relativement longue (%s)
	SEP
	echo -e "\n${BLANCB}REPOS ARCHIVES :${RESET}\n"
	echo -ne "$CYAN"; printf "$TAILLE_COLONNES" " Nom" "Date" "Taille" "Description"; echo -ne "$RESET"
	while IFS=, read REPO_NAME REPO_HOST  REPO_DATE REPO_DESCRIPTION;do # Parcourt du fichier repos-archive.list
		REPO_NAME=$(echo "$REPO_NAME" | cut -d'=' -f2 | sed 's/"//g')
		REPO_DATE=$(echo "$REPO_DATE" | cut -d'=' -f2 | sed 's/"//g')
		REPO_DESCRIPTION=$(echo "$REPO_DESCRIPTION" | cut -d'=' -f2 | sed 's/"//g')
		REPO_SIZE=$(du -hs ${REPOS_DIR}/archived_${REPO_DATE}_${REPO_NAME} | awk '{print $1}')	# Récup de la taille du snapshot
		if [ "$REPO_NAME" = "$var_list_repo" ];then :; else if [ $i -eq 0 ];then (( i++ )); elif [ $i -gt 0 ];then i=0;fi;fi	# Affichage des informations sous la forme  "repo  env  date  taille"
		if [ $i -eq 0 ];then echo -ne "$GRIS"; printf "$TAILLE_COLONNES" " $REPO_NAME" "$REPO_ENV" "$REPO_DATE" "$REPO_SIZE" "$REPO_DESCRIPTION"; echo -ne "$RESET";fi # en alternant entre les couleurs gris / blanc afin de regrouper les repos de meme nom (ex epel prod et epel test) sous la même couleur et rendre le tableau plus facile à lire
		if [ $i -gt 0 ];then printf "$TAILLE_COLONNES" " $REPO_NAME" "$REPO_DATE" "$REPO_SIZE" "$REPO_DESCRIPTION"; fi
		var_list_repo="$REPO_NAME"
	done < $REPOS_ARCHIVE_LIST
	echo ""; SEP
fi

if [ "$OS_FAMILY" == "Debian" ];then
	TAILLE_COLONNES="%-30s %-20s %-20s %-15s %-10s %-s\n"
	SEP
	echo -e "\n${BLANCB}REPOS ARCHIVES :${RESET}\n"
	echo -ne "$CYAN";printf "$TAILLE_COLONNES" " Nom" "Distribution" "Section" "Date" "Taille" "Description";echo -ne "$RESET";
	while IFS=, read REPO_NAME REPO_HOST REPO_DIST REPO_SECTION REPO_DATE REPO_DESCRIPTION;do # Parcourt du fichier repos.list
		REPO_NAME=$(echo "$REPO_NAME" | cut -d'=' -f2 | sed 's/"//g')
		REPO_DIST=$(echo "$REPO_DIST" | cut -d'=' -f2 | sed 's/"//g')
		REPO_SECTION=$(echo "$REPO_SECTION" | cut -d'=' -f2 | sed 's/"//g')
		REPO_DATE=$(echo "$REPO_DATE" | cut -d'=' -f2 | sed 's/"//g')
		REPO_DESCRIPTION=$(echo "$REPO_DESCRIPTION" | cut -d'=' -f2 | sed 's/"//g')
		TAILLE_REPO=$(du -hs ${REPOS_DIR}/${REPO_NAME}/${REPO_DIST}/archived_${REPO_DATE}_${REPO_SECTION} | awk '{print $1}') # Récup de la taille du snapshot
		printf "$TAILLE_COLONNES" " $REPO_NAME" "$REPO_DIST" "$REPO_SECTION" "$REPO_DATE" "$TAILLE_REPO" "$REPO_DESCRIPTION"
	done < $REPOS_ARCHIVE_LIST
	echo ""; SEP
fi

espace_disque